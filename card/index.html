<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>カード金額計算フォーム</title>
    <link rel="icon" href="/fa.png" />
    <style>
      html {
        background-color: rgb(52, 161, 161);
        color: aliceblue;
        height: 100%;
        width: 100%;
        min-width: 375px;
        font-size: 22px;
        font-family: "Yu Gothic", "YuGothic", "Meiryo";
      }

      h2 {
        background: linear-gradient(aliceblue, rgb(138, 251, 151));
        background-clip: text;
        -webkit-text-fill-color: transparent;
        font-size: 45px;
      }

      #name {
        width: 250px;
        font-size: 20px;
      }

      #amount {
        width: 70px;
        font-size: 20px;
      }

      #quantity {
        width: 70px;
        font-size: 20px;
      }

      button {
        margin-top: 7px;
        background-color: rgb(161, 161, 161);
        color: rgb(255, 255, 255);
        font-weight: bold;
        font-size: 20px;
      }

      form {
        display: flex;
      }

      .sa {
        margin-right: 1cqh;
      }

      #button {
        font: 58px;
      }

      #message {
        font-size: 22px;
        font-weight: bold;
        color: rgb(255, 0, 0);
        background-color: yellow;
        max-width: 100%;
      }
      .table,
      .li {
        display: flex;
      }

      #tableName {
        width: 400px;
      }

      #tableAmount,
      #tableQuantity {
        width: 70px;
      }

      #sumAmount {
        width: auto;
        margin-left: 0.5px;
        margin-top: auto;
        margin-bottom: 0.1px;
        font-weight: bold;
        text-align: right;
      }

      #sumAmount,
      table,
      th,
      td {
        border-collapse: collapse;
        border: #000000 solid 1px;
        background-color: rgb(255, 255, 255);
        color: rgb(0, 0, 0);

        max-width: 1000px;
      }

      td {
        text-align: center;
      }

      .left {
        text-align: left;
      }

      .right {
        text-align: right;
      }

      a {
        margin-top: 15%;
        display: inline-block;
        transition: 0.5s;
      }
      a:hover {
        color: aqua;
      }

      footer {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background-color: rgb(28, 75, 27);
        padding: 5px;
        text-align: center;
      }

      @media (max-width: 735px) {
        h2 {
          font-size: 20px;
        }

        #name {
          width: 165px;
          font-size: 16px;
        }

        #amount,
        #quantity {
          width: 70px;
          font-size: 16px;
        }

        button {
          font-size: 8px;
        }

        #message {
          font-size: 11px;
          font-weight: bold;
          color: rgb(255, 0, 0);
          background-color: yellow;
        }

        label {
          font-size: 15px;
        }

        #sumAmount,
        .li,
        a {
          font-size: 13px;
          max-width: 300px;
        }

        #capture {
          width: auto;
        }

        footer {
          font-size: 12px;
        }
      }
    </style>
  </head>
  <body>
    <h2>カード金額計算フォーム</h2>
    <form id="form">
      <div class="sa">
        <label>カード名: <input type="text" id="name" maxlength="113" /></label
        ><br />
        <label
          >値段　　:
          <input type="number" id="amount" min="0" max="99999" /></label
        ><br />

        <!-- <label
          >個数　　:
          <select id="quantity">
            <option value="">選択してください</option>
          </select>
        </label> -->
        <label
          >枚数　　: <input type="number" id="quantity" min="1" max="40"
        /></label>
      </div>

      <button type="submit">カードをリストに追加</button>
    </form>

    <p id="message"></p>

    <div class="li" id="target">
      <table id="table">
        <tr>
          <th id="cardName">カード名</th>
          <th>値段</th>
          <th>購入枚数</th>
          <th>小計</th>
          <th>総計に含む</th>
          <!-- <th>編集</th> -->
          <th>削除</th>
        </tr>
      </table>
    </div>
    <p id="sumAmount">総計: 0円</p>
    <button id="capture">リストを画像として保存</button><br />
    <a href="https://highmetal.github.io">https://highmetal.github.io</a>
    <footer>
      <small>&copy; 2025 highmetal or Organization. All rights reserved.</small>
    </footer>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script>
      "use strict";

      const table = document.getElementById("table");
      const quantitySelect = document.getElementById("quantity");

      //チェックされている合計金額
      function updateSum() {
        let sum = 0;
        const rows = table.querySelectorAll("tr[data-amount]");
        rows.forEach((row) => {
          const checkbox = row.querySelector("input[type='checkbox']");
          if (checkbox.checked) {
            sum += Number(row.dataset.amount);
          }
        });
        document.getElementById(
          "sumAmount"
        ).textContent = `総計: ${sum.toLocaleString()}円`; //3桁区切り
      }

      document.getElementById("form").onsubmit = function (event) {
        event.preventDefault();

        const name = document.getElementById("name").value.trim();
        const amount = Number(document.getElementById("amount").value);
        const quantity = Number(document.getElementById("quantity").value);

        if (name === "") {
          document.getElementById("message").textContent =
            "カード名が入力されていません。";
          return;
        }
        if (document.getElementById("amount").value.trim() === "") {
          document.getElementById("message").textContent =
            "値段が入力されていません。";
          return;
        }

        if (Number.isNaN(quantity) || quantity === 0) {
          document.getElementById("message").textContent =
            "枚数が選択されていません。";
          return;
        }

        document.getElementById("message").textContent = "";

        //合計金額計算
        const subtotal = amount * quantity;

        //テーブルに行を追加
        const newRow = table.insertRow();
        newRow.dataset.amount = subtotal;

        //各セルを作成
        newRow.insertCell().textContent = name;
        newRow.insertCell().textContent = amount.toLocaleString();
        newRow.insertCell().textContent = quantity;
        newRow.insertCell().textContent = subtotal.toLocaleString();

        //チェックボックス作成
        const checkCell = newRow.insertCell();
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = true;
        checkbox.addEventListener("change", updateSum);
        checkCell.appendChild(checkbox);

        //削除ボタン作成
        const deleteCell = newRow.insertCell();
        const delBtn = document.createElement("button");
        delBtn.textContent = "×";
        delBtn.addEventListener("click", function () {
          if (
            window.confirm(`リストから”${name}”を削除してもよろしいですか？`)
          ) {
            newRow.remove();
          }

          updateSum();
        });
        deleteCell.appendChild(delBtn);

        updateSum();

        event.target.reset();
      };

      //スクショボタン
      document.getElementById("capture").addEventListener("click", () => {
        if (document.getElementById("sumAmount").textContent !== "総計: 0円") {
          if (window.confirm(`リストを画像として保存しますか？`)) {
            const target = document.getElementById("target");
            html2canvas(target).then((canvas) => {
              // 画像をダウンロード
              const link = document.createElement("a");
              link.download = "screenshot.png";
              link.href = canvas.toDataURL();
              link.click();
            });
          }
        } else {
          document.getElementById("message").textContent =
            "リストが未完成のため保存できません";
        }
      });
    </script>
  </body>
</html>
