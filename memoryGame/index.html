<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>memoryGame</title>
    <style>
      .game {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
      }
      .card {
        background-color: black;
        color: white;
        padding: 20px;
        text-align: center;
      }
      .button {
        margin-top: 3%;
      }
    </style>
  </head>

  <body>
    <h4>神経衰弱</h4>
    <div class="game">
      <div class="card">c</div>
      <div class="card">c</div>
      <div class="card">c</div>
      <div class="card">c</div>
      <div class="card">c</div>
      <div class="card">c</div>
      <div class="card">c</div>
      <div class="card">c</div>
    </div>
    <button class="button">リトライ</button>

    <script>
      "use strict";

      let pairCard = [
        "pair1",
        "pair1",
        "pair2",
        "pair2",
        "pair3",
        "pair3",
        "pair4",
        "pair4",
      ]; //カードの種類

      shuffleArray(pairCard); //カードシャッフル

      const card = document.querySelectorAll(".card"); //htmlのカード取得

      card.forEach(function (element, i) {
        //カードに種類ごとのクラスとクリック時イベントを追加
        card[i].classList.add(pairCard[i]);
        element.addEventListener("click", check);
        //console.log(card[i]);
      });

      const button = document.querySelector(".button"); //リトライボタン
      button.addEventListener("click", retry);

      function retry() {
        isStop = false;
        isFirstUp = false;
        firstUp = null;
        secondUp = null;
        shuffleArray(pairCard);
        card.forEach(function (element, i) {
          element.textContent = "c";
          element.style.color = "white";
          element.classList.remove("match");
          element.classList.remove("pair1", "pair2", "pair3", "pair4");
          element.classList.add(pairCard[i]);
        });
      }

      let isStop = false; //カードを表にする処理をさせるかどうか
      let isFirstUp = false; //カードを表向きにするのが１枚目かどうか
      let firstUp = null; //１枚目の表向きにしたカードを記憶
      let secondUp = null; //２枚目の表向きにしたカードを記憶

      function check(el) {
        if (isStop) return;
        if (el.currentTarget.classList[2] === "match") return;
        console.log(el.currentTarget.classList[1]);
        if (!isFirstUp) {
          //表にしたカードが１枚目の場合の処理
          isFirstUp = true;
          firstUp = el.currentTarget;
          firstUp.textContent = el.currentTarget.classList[1].charAt(4); //数字が二桁になるとバグる
        } else {
          //表にしたカードが２枚目の場合の処理
          if (firstUp === el.currentTarget) return;
          secondUp = el.currentTarget;
          secondUp.textContent = el.currentTarget.classList[1].charAt(4); //数字が二桁になるとバグる

          if (firstUp.classList[1] === secondUp.classList[1]) {
            //正解の処理
            firstUp.classList.add("match");
            secondUp.classList.add("match");

            isStop = true;
            setTimeout(function () {
              firstUp.style.color = "red";
              secondUp.style.color = "red";
              isStop = false;
            }, 1000);
          } else {
            //不正解の処理
            isStop = true;
            setTimeout(function () {
              firstUp.textContent = "c";
              secondUp.textContent = "c";
              isStop = false;
            }, 1000);
          }
          isFirstUp = false;
        }
      }

      function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
      }
    </script>
  </body>
</html>
